<?xml version="1.0" encoding="UTF-8"?>
<templates id="template" xml:space="preserve">
    <t t-name="point_of_sale.PartnerDetailsEdit" t-inherit="point_of_sale.PartnerDetailsEdit" t-inherit-mode="extension">
        <!-- Add Customer Group field before Pricelist -->
        <xpath expr="//div[contains(@class, 'partner-detail') and .//label[@for='pricelist']]" position="before">
            <div class="partner-detail col">
                <label class="form-label label" for="customergroup">Customer Group</label>
                <select 
                    class="detail form-select" 
                    id="customergroup" 
                    name="vit_customer_group" 
                    t-model="changes.vit_customer_group" 
                    t-on-change="onCustomerGroupChange"
                    t-att="{'disabled': isFieldCommercialAndPartnerIsChild('vit_customer_group')}" 
                    t-att-class="{'border-danger': missingFields.includes('vit_customer_group')}">
                    <option value="">None</option>
                    <t t-foreach="customerGroups" t-as="customerGroup" t-key="customerGroup.id">
                        <option 
                            t-att-value="customerGroup.id"
                            t-att-selected="changes.vit_customer_group === customerGroup.id ? true : undefined">
                            <t t-esc="customerGroup.vit_group_name" />
                        </option>
                    </t>
                </select>
            </div>
        </xpath>

        <!-- Make Pricelist readonly when customer group is selected -->
        <xpath expr="//div[contains(@class, 'partner-detail') and .//label[@for='pricelist']]//select[@id='pricelist']" position="attributes">
            <attribute name="t-att-disabled">changes.vit_customer_group ? 'disabled' : isFieldCommercialAndPartnerIsChild('property_product_pricelist')</attribute>
            <attribute name="t-att-class">{'border-danger': missingFields.includes('property_product_pricelist'), 'bg-light': changes.vit_customer_group}</attribute>
        </xpath>
    </t>
</templates>