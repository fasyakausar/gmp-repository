<?xml version="1.0" encoding="UTF-8"?>
<templates id="template" xml:space="preserve">
    <t t-name="point_of_sale.ProductScreenPatched">
        <div class="product-screen d-flex h-100" t-att-class="{ 'd-none': !props.isShown }">
            
            <!-- ==================== KOLOM 1: CONTROL PANEL (KIRI) ==================== -->
            <div class="leftpane" 
                t-att-class="{ 'mobile-active': pos.mobile_pane === 'control' }">
                
                <!-- COMPANY LOGO SECTION DIHAPUS - DIPINDAH KE NAVBAR -->
                
                <div class="pads">
                    <!-- Control Buttons Grid -->
                    <div class="control-buttons">
                        <t t-foreach="controlButtons" t-as="cb" t-key="cb.name">
                            <t t-component="cb.component" t-key="cb.name" class="'control-btn-item'"/>
                        </t>
                    </div>
                    
                    <!-- LOYALTY POINTS SECTION -->
                    <t t-set="_loyaltyPoints" t-value="pos.get_order()?.getLoyaltyPoints() or []" />
                    <t t-set="_currentPartner" t-value="pos.get_order()?.get_partner()" />
                    
                    <t t-if="_currentPartner and (_loyaltyPoints.length > 0 or _currentPartner.is_store)">
                        <t t-foreach="_loyaltyPoints" t-as="_loyaltyStat" t-key="_loyaltyStat.couponId">
                            <div t-if="_currentPartner.is_store or _loyaltyStat.points.won or _loyaltyStat.points.spent" 
                                class="loyalty-section">
                                <div t-esc="_loyaltyStat.points.name" class="loyalty-points-title" />
                                <div class="loyalty-points-grid">
                                    <div class="loyalty-points-balance">
                                        <span class="text-muted">Balance</span>
                                        <span class='value'><t t-esc='_loyaltyStat.points.balance'/></span>
                                    </div>
                                    <div class="loyalty-points-won">
                                        <span class="text-muted">Won</span>
                                        <span class='value'>+<t t-esc='_loyaltyStat.points.won'/></span>
                                    </div>
                                    <div t-if='_loyaltyStat.points.spent' 
                                        class="loyalty-points-spent">
                                        <span class="text-muted">Spent</span>
                                        <span class='value'>-<t t-esc='_loyaltyStat.points.spent'/></span>
                                    </div>
                                    <div class="loyalty-points-total">
                                        <span class="text-muted">Total</span>
                                        <span class='value'><t t-esc='_loyaltyStat.points.total'/></span>
                                    </div>
                                </div>
                            </div>
                        </t>
                    </t>
                    
                    <!-- Numpad + Action Pad -->
                    <div class="subpads">
                        <ActionpadWidget
                            partner="partner"
                            actionName="constructor.numpadActionName"
                            actionType="'payment'"
                            onClickMore.bind="displayAllControlPopup"
                            class="'actionpad-widget'" />
                        <Numpad 
                            buttons="getNumpadButtons()" 
                            onClick.bind="onNumpadClick"
                            class="'numpad-widget'" />
                    </div>
                </div>
            </div>

            <!-- ==================== KOLOM 2: PRODUCTS (TENGAH) ==================== -->
            <div class="centerpane" 
                t-att-class="{ 'mobile-active': pos.mobile_pane === 'products' }">
                <ProductsWidget class="'flex-grow-1'" />
            </div>

            <!-- ==================== KOLOM 3: ORDER LIST (KANAN) DENGAN HEADER ==================== -->
            <div class="rightpane" 
                t-att-class="{ 'mobile-active': pos.mobile_pane === 'order' }">
                
                <!-- üõí ORDER LIST HEADER - BARU DITAMBAHKAN! -->
                <div class="order-list-header">
                    <i class="fa fa-shopping-cart order-list-icon"></i>
                    <span class="order-list-title">Shopping Cart</span>
                </div>
                
                <!-- ORDER WIDGET - Existing, tetap sama -->
                <OrderWidget 
                    class="'flex-grow-1 d-flex flex-column overflow-hidden'"
                    lines="currentOrder.orderlines" 
                    t-slot-scope="scope"
                    total="env.utils.formatCurrency(currentOrder.get_total_with_tax())"
                    tax="!env.utils.floatIsZero(currentOrder.get_total_tax()) and env.utils.formatCurrency(currentOrder.get_total_tax()) or ''">
                    
                    <t t-set="line" t-value="scope.line" />
                    <Orderline 
                        line="line.getDisplayData()"
                        t-on-click="() => this.selectLine(line)"
                        class="{ ...line.getDisplayClasses(), 'selected' : line.selected }">
                        
                        <t t-set-slot="product-name">
                            <i  t-if="line.get_product().isTracked()"
                                t-on-click.stop="() => line.editPackLotLines()" 
                                role="img"
                                t-attf-class="{{ line.has_valid_product_lot() ? 'text-success' : 'text-danger'}} fa fa-list line-lot-icon ms-1"
                                t-attf-title="{{ line.has_valid_product_lot() ? 'Valid product lot' : 'Invalid product lot'}}" />
                        </t>
                        
                        <ul t-if="line.pack_lot_lines">
                            <li t-foreach="line.get_lot_lines()" t-as="lot" t-key="lot.cid">
                                SN <t t-esc="lot.lot_name"/>
                            </li>
                        </ul>
                        
                        <li t-if="line.isGiftCardOrEWalletReward()">
                            Current Balance: <t t-esc="line.getGiftCardOrEWalletBalance()"/>
                        </li>
                    </Orderline>
                </OrderWidget>
            </div>

            <!-- Mobile Navigation Tabs -->
            <div class="mobile-nav-tabs d-md-none" t-if="ui.isSmall">
                <button 
                    t-on-click="() => this.setMobilePane('control')"
                    t-att-class="{ 'active': pos.mobile_pane === 'control' }">
                    <span class="icon">‚öôÔ∏è</span>
                    <span>Control</span>
                </button>
                <button 
                    t-on-click="() => this.setMobilePane('products')"
                    t-att-class="{ 'active': pos.mobile_pane === 'products' }">
                    <span class="icon">üõçÔ∏è</span>
                    <span>Products</span>
                </button>
                <button 
                    t-on-click="() => this.setMobilePane('order')"
                    t-att-class="{ 'active': pos.mobile_pane === 'order' }">
                    <span class="icon">üõí</span>
                    <span>Cart (<t t-esc="currentOrder.orderlines.length"/>)</span>
                </button>
            </div>

        </div>
    </t>
</templates>